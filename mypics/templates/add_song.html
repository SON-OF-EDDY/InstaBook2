{%extends 'base.html'%}

{% block content%}

    {%if user.is_authenticated %}




                <style>
                

                #clickableAwesomeFont {
                    cursor: pointer;


                }




                </style>
<hr/>
                <h1>MY SONGS</h1>
<hr/>
                <br>
                <br>

                <span id='clickableAwesomeFont'><i id = 'changing-icon' class="fa-solid fa-circle-down fa-3x" style="color:#ffc008"></i>
                </span>

                <br><br><h6><b>ADD SONG</b></h6>



                <script>

                    function animate_icon() {

                          var icon = document.getElementById('changing-icon');

                          // change to 2
                          setTimeout(function () {
                            icon.className = "fa-regular fa-circle-down fa-3x";
                          }, 125);

                          //back to 1
                          setTimeout(function () {
                            icon.className = "fa-solid fa-circle-down fa-3x";
                          }, 250);

                     }

                    document.getElementById('clickableAwesomeFont').onclick = function() {
                        animate_icon();
                        setTimeout(function () {
                            document.getElementById("scroll-location").scrollIntoView();
                          }, 250);
                    };

                </script>



                <br>

                    {%if show_table %}
                       <br>
                        <br>

                    <table class="table">

                    <thead class="thead-dark">

                    <tr>

                      <th scope="col"></th>



                    </tr>

                  </thead>

                  <tbody>

                      {%for entry in entries%}

                          {%if current_user == entry.author %}

                          <tr>

                              <td style="word-break:break-all;"><b>Title:</b><br>
                                  {{entry.title}}
                                  <br>
                                  <br>
                                  <b>Artist:</b>
                                  <br>
                                  {{entry.artist}}

                                    <br><br>

                                  <audio id ='my-audio{{entry.id}}' controls style="width: 300px;">
                                    <source src="{{entry.song_file.url}}" type="audio/mp3">
                                    </audio>

                                  <script>

                                            function detectMob() {
                                                const toMatch = [
                                                    /Android/i,
                                                    /webOS/i,
                                                    /iPhone/i,
                                                    /iPad/i,
                                                    /iPod/i,
                                                    /BlackBerry/i,
                                                    /Windows Phone/i
                                                ];

                                                return toMatch.some((toMatchItem) => {
                                                    return navigator.userAgent.match(toMatchItem);
                                                });
                                            }


                                            if (detectMob()) {

                                                document.getElementById('my-audio'+{{entry.id}}).style["max-width"] = '300px';

                                            } else {

                                                document.getElementById('my-audio'+{{entry.id}}).style["max-width"] = '300px';
                                            }


                                        </script>


                                  <br>
                                  <br>

                                  <button type="button" class="btn btn-outline-warning" data-toggle="modal" data-target="#{{entry.id}}">
                            Delete Song
                                  </button>
                                  <br><br>

                           <div class="modal fade" id="{{entry.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">WARNING</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                  <span aria-hidden="true">&times;</span>
                                                </button>
                                              </div>
                                              <div class="modal-body">
                                                Are you sure you want to delete this song?
                                              </div>
                                                <div class="modal-footer">

                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>

                                                  <a  href="{%url 'delete_song' entry.id%}" class="btn btn-outline-warning">Yes</a>

                                                </div>
                                </div>
                              </div>
                            </div>

                          <a  href="{%url 'edit_song' entry.id%}" class="btn btn-warning">Edit Song</a>











                              </td>




                          </tr>

                          {%endif%}

                      {%endfor%}

                  </tbody>
                </table>

                    {%else%}
<br>


<div class="card mb-3" style="max-width: 540px;">
                  <div class="row g-0">


<div class="col-md-8">
                      <div class="card-body">


                          <p style="font-size:24px;" class="card-text"><h4>You have no saved music!</h4></p>



                      </div>
                    </div>
                  </div>
                </div>






                  {%endif%}


                <br>
                <br>
<br>
<br>
<hr/>

                <h1 id="scroll-location">ADD A SONG</h1>
<hr/>
                <br>
                <br>

                <form action="{%url 'add_song'%}" method="POST" enctype="multipart/form-data">

                    {% csrf_token%}

                    {{form.as_p}}

                    <button type="submit" class="btn btn-warning">Add</button>
                    <br>
                    <br>
                    <br>
                    <br>

                </form>

{%else%}
    <h2>You must be logged in to view this page.</h2>


{%endif%}


{%endblock%}
