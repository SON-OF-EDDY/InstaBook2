{%extends 'base.html'%}
{% load static %}

{% block content%}

    {%if user.is_authenticated %}


    <div id="mobile-checker"></div>

    <style>
    img{
        cursor: pointer;
    }

    #clickableAwesomeFont {
        cursor: pointer;


    }

    </style>

<hr/>
                <h1>MY PICS</h1>
<hr/>
<br>

                 <br>
                <span id='clickableAwesomeFont'><i id = 'changing-icon' class="fa-solid fa-circle-down fa-3x"></i>
                </span>

                <br><br><h6><b>ADD PIC</b></h6>

                <script>

                     function animate_icon() {

                          var icon = document.getElementById('changing-icon');

                          // change to 2
                          setTimeout(function () {
                            icon.className = "fa-regular fa-circle-down fa-3x";
                          }, 125);

                          //back to 1
                          setTimeout(function () {
                            icon.className = "fa-solid fa-circle-down fa-3x";
                          }, 250);

                     }

                    document.getElementById('clickableAwesomeFont').onclick = function() {
                        animate_icon();
                        setTimeout(function () {
                            document.getElementById("scroll-location").scrollIntoView();
                          }, 250);
                    };

                </script>



                <br>

                    {%if show_table %}
                       <br>
                        <br>

                    <table class="table">

                    <thead class="thead-dark">

                    <tr>

                      <th scope="col"></th>


                    </tr>

                  </thead>

                  <tbody>

                      {%for entry in entries%}

                          {%if current_user == entry.author %}

                          <tr>

                              <td style="word-break:break-all;"><b>Title: </b>{{entry.title}}<br><br><b>Description: </b>{{entry.description}}

                              <br><br>


                              <img src="{{entry.picture_image.url}}" data-toggle="modal" data-target="#modalz{{entry.id}}" width="100">



                              <br><br>

                                   <button type="button" class="btn btn-outline-danger
                              btn-sm" data-toggle="modal" data-target="#{{entry.id}}">
                            Delete Image
                                  </button>
                                  <br><br>


                           <div class="modal fade" id="{{entry.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">WARNING</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                  <span aria-hidden="true">&times;</span>
                                                </button>
                                              </div>
                                              <div class="modal-body">
                                                Are you sure you want to delete this image?
                                              </div>
                                                <div class="modal-footer">

                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>

                                                  <a  href="{%url 'delete_pic' entry.id%}" class="btn btn-outline-primary
                                                      btn-sm">Yes</a>

                                                </div>
                                </div>
                              </div>
                            </div>


                            <div class="modal fade" id="modalz{{entry.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2" aria-hidden="true">
                                <div id = 'type{{entry.id}}' class="modal-dialog modal-dialog-centered" style="max-width: 135px" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header text-center">
                                                <h5 class="modal-title w-100" id="exampleModalLabel2" style="text-align:center">TITLE: "{{entry.title}}"</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                  <span aria-hidden="true">&times;</span>
                                                </button>
                                              </div>
                                              <div class="modal-body" style="width: auto; margin-left: auto; margin-right: auto">
                                                  <img id = "resize{{entry.id}}" src="{{entry.picture_image.url}}" width = "600">

                                              </div>
                                                <div class="modal-footer">

                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                                                </div>
                                </div>
                              </div>
                            </div>

                           <script>

                                function detectMob() {
                                    const toMatch = [
                                        /Android/i,
                                        /webOS/i,
                                        /iPhone/i,
                                        /iPad/i,
                                        /iPod/i,
                                        /BlackBerry/i,
                                        /Windows Phone/i
                                    ];

                                    return toMatch.some((toMatchItem) => {
                                        return navigator.userAgent.match(toMatchItem);
                                    });
                                }

                                //console.log(detectMob());

                                if (detectMob()) {

                                    var to_log_1 = screen.availWidth * 0.95;
                                    var to_log_2 = to_log_1 * 0.9;

                                    document.getElementById('resize'+{{entry.id}}).width = to_log_2;
                                    document.getElementById('type'+{{entry.id}}).style["max-width"] = `${to_log_1}px`;


                                    //document.getElementById('mobile-checker').innerHTML = 'Mobile';

                                } else {

                                    var to_log_1 = (screen.availWidth * 0.5) ;

                                    var actual_width = document.getElementById('resize'+{{entry.id}}).naturalWidth;

                                    if (actual_width > (to_log_1 * 0.9)) {
                                        var to_log_2 = to_log_1 * 0.9;

                                    } else {
                                        var to_log_2 = actual_width;
                                    }


                                    document.getElementById('resize'+{{entry.id}}).width = to_log_2;
                                    document.getElementById('type'+{{entry.id}}).style["max-width"] = `${to_log_1}px`;

                                    //document.getElementById('mobile-checker').innerHTML = 'PC';


                                }


                            </script>

                          <a  href="{%url 'edit_pic' entry.id%}" class="btn btn-outline-primary
                          btn-sm">Edit image</a>




                              </td>





                          </tr>

                          {%endif%}

                      {%endfor%}

                  </tbody>
                </table>

                    {%else%}
                    <br>


                    <div class="card mb-3" style="max-width: 540px;">
                  <div class="row g-0">


<div class="col-md-8">
                      <div class="card-body">


                          <p style="font-size:24px;" class="card-text"><h3>You have no saved images!</h3></p>



                      </div>
                    </div>
                  </div>
                </div>






                  {%endif%}


                <br>
                <br><br><br>
<hr/>

                <h1 id="scroll-location">ADD A PIC</h1>
<hr/>
                <br>
                <br>

                <form action="{%url 'add_pics'%}" method="POST" enctype="multipart/form-data">

                    {% csrf_token%}

                    {{form.as_p}}

                    <button type="submit" class="btn btn-primary">Add</button>
                    <br>
                    <br>
                    <br>
                    <br>

                </form>

{%else%}
    <h2>You must be logged in to view this page.</h2>


{%endif%}


{%endblock%}


